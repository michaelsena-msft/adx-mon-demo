{
  "title": "Demo App - adx-mon",
  "uid": "demo-app-adxmon",
  "tags": [
    "adx-mon",
    "demo"
  ],
  "timezone": "browser",
  "schemaVersion": 16,
  "version": 1,
  "refresh": "30s",
  "panels": [
    {
      "id": 1,
      "title": "Request Rate (ADX via adx-mon)",
      "type": "timeseries",
      "gridPos": {
        "x": 0,
        "y": 0,
        "w": 12,
        "h": 8
      },
      "datasource": {
        "type": "grafana-azure-data-explorer-datasource",
        "uid": "efch28p7ii0aoa"
      },
      "targets": [
        {
          "datasource": {
            "type": "grafana-azure-data-explorer-datasource",
            "uid": "efch28p7ii0aoa"
          },
          "database": "Metrics",
          "resultFormat": "time_series",
          "pluginVersion": "5.0.5",
          "OpenAI": false,
          "expression": {
            "where": {
              "expressions": [],
              "type": "and"
            },
            "groupBy": {
              "expressions": [],
              "type": "and"
            },
            "reduce": {
              "expressions": [],
              "type": "and"
            }
          },
          "query": "NginxHttpRequestsTotal\n| where $__timeFilter(Timestamp)\n| where Cluster == \"aks-adx-mon\"\n| invoke prom_delta()\n| summarize Value=sum(Value) by bin(Timestamp, 30s)\n| order by Timestamp asc",
          "refId": "A"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "fillOpacity": 20,
            "showPoints": "never"
          },
          "unit": "reqps"
        }
      }
    },
    {
      "id": 2,
      "title": "Request Rate (Managed Prometheus)",
      "type": "timeseries",
      "gridPos": {
        "x": 12,
        "y": 0,
        "w": 12,
        "h": 8
      },
      "datasource": {
        "type": "prometheus",
        "uid": "amw-adx-mon"
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "amw-adx-mon"
          },
          "expr": "sum(rate(nginx_http_requests_total[1m]))",
          "refId": "A",
          "legendFormat": "requests/sec"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "fillOpacity": 20,
            "showPoints": "never"
          },
          "unit": "reqps"
        }
      }
    },
    {
      "id": 3,
      "title": "Container CPU (ADX via adx-mon)",
      "type": "timeseries",
      "gridPos": {
        "x": 0,
        "y": 8,
        "w": 12,
        "h": 8
      },
      "datasource": {
        "type": "grafana-azure-data-explorer-datasource",
        "uid": "efch28p7ii0aoa"
      },
      "targets": [
        {
          "datasource": {
            "type": "grafana-azure-data-explorer-datasource",
            "uid": "efch28p7ii0aoa"
          },
          "database": "Metrics",
          "resultFormat": "time_series",
          "pluginVersion": "5.0.5",
          "OpenAI": false,
          "expression": {
            "where": {
              "expressions": [],
              "type": "and"
            },
            "groupBy": {
              "expressions": [],
              "type": "and"
            },
            "reduce": {
              "expressions": [],
              "type": "and"
            }
          },
          "query": "ContainerCpuUsageSecondsTotal\n| where $__timeFilter(Timestamp)\n| where Cluster == \"aks-adx-mon\"\n| where Labels.pod startswith \"demo-app\"\n| where Labels.container == \"nginx\"\n| invoke prom_delta()\n| summarize Value=avg(Value) by bin(Timestamp, 30s), tostring(Labels.pod)\n| order by Timestamp asc",
          "refId": "A"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "fillOpacity": 20,
            "showPoints": "never"
          },
          "unit": "s"
        }
      }
    },
    {
      "id": 4,
      "title": "Container CPU (Managed Prometheus)",
      "type": "timeseries",
      "gridPos": {
        "x": 12,
        "y": 8,
        "w": 12,
        "h": 8
      },
      "datasource": {
        "type": "prometheus",
        "uid": "amw-adx-mon"
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "amw-adx-mon"
          },
          "expr": "rate(container_cpu_usage_seconds_total{pod=~\"demo-app.*\", container=\"nginx\"}[5m])",
          "refId": "A",
          "legendFormat": "{{pod}}"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "fillOpacity": 20,
            "showPoints": "never"
          },
          "unit": "s"
        }
      }
    },
    {
      "id": 5,
      "title": "Container Memory (ADX via adx-mon)",
      "type": "timeseries",
      "gridPos": {
        "x": 0,
        "y": 16,
        "w": 8,
        "h": 8
      },
      "datasource": {
        "type": "grafana-azure-data-explorer-datasource",
        "uid": "efch28p7ii0aoa"
      },
      "targets": [
        {
          "datasource": {
            "type": "grafana-azure-data-explorer-datasource",
            "uid": "efch28p7ii0aoa"
          },
          "database": "Metrics",
          "resultFormat": "time_series",
          "pluginVersion": "5.0.5",
          "OpenAI": false,
          "expression": {
            "where": {
              "expressions": [],
              "type": "and"
            },
            "groupBy": {
              "expressions": [],
              "type": "and"
            },
            "reduce": {
              "expressions": [],
              "type": "and"
            }
          },
          "query": "ContainerMemoryWorkingSetBytes\n| where $__timeFilter(Timestamp)\n| where Cluster == \"aks-adx-mon\"\n| where Labels.pod startswith \"demo-app\"\n| where Labels.container == \"nginx\"\n| summarize Value=avg(Value) by bin(Timestamp, 30s), tostring(Labels.pod)\n| order by Timestamp asc",
          "refId": "A"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "fillOpacity": 20,
            "showPoints": "never"
          },
          "unit": "bytes"
        }
      }
    },
    {
      "id": 6,
      "title": "Demo App Logs (ADX via adx-mon)",
      "type": "logs",
      "gridPos": {
        "x": 8,
        "y": 16,
        "w": 8,
        "h": 8
      },
      "datasource": {
        "type": "grafana-azure-data-explorer-datasource",
        "uid": "efch28p7ii0aoa"
      },
      "targets": [
        {
          "datasource": {
            "type": "grafana-azure-data-explorer-datasource",
            "uid": "efch28p7ii0aoa"
          },
          "database": "Logs",
          "resultFormat": "table",
          "pluginVersion": "5.0.5",
          "OpenAI": false,
          "expression": {
            "where": {
              "expressions": [],
              "type": "and"
            },
            "groupBy": {
              "expressions": [],
              "type": "and"
            },
            "reduce": {
              "expressions": [],
              "type": "and"
            }
          },
          "query": "DemoApp\n| where $__timeFilter(Timestamp)\n| project Timestamp, Body\n| order by Timestamp desc\n| take 100",
          "refId": "A"
        }
      ],
      "options": {
        "showTime": true,
        "wrapLogMessage": false,
        "sortOrder": "Descending"
      }
    },
    {
      "id": 7,
      "title": "Demo App Logs (Container Insights)",
      "type": "logs",
      "gridPos": {
        "x": 16,
        "y": 16,
        "w": 8,
        "h": 8
      },
      "datasource": {
        "type": "grafana-azure-monitor-datasource",
        "uid": "azure-monitor-oob"
      },
      "targets": [
        {
          "datasource": {
            "type": "grafana-azure-monitor-datasource",
            "uid": "azure-monitor-oob"
          },
          "azureLogAnalytics": {
            "query": "ContainerLogV2\n| where PodNamespace == \"default\" and PodName startswith \"demo-app\"\n| project TimeGenerated, LogMessage, PodName, ContainerName\n| order by TimeGenerated desc\n| take 100",
            "resultFormat": "logs",
            "resource": "/subscriptions/a7856baf-2b8e-485c-a7f9-a45544aaa20b/resourceGroups/rg-adx-mon/providers/Microsoft.OperationalInsights/workspaces/law-adx-mon"
          },
          "queryType": "Azure Log Analytics",
          "refId": "A"
        }
      ],
      "options": {
        "showTime": true,
        "wrapLogMessage": false,
        "sortOrder": "Descending"
      }
    }
  ]
}
